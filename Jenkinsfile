pipeline {
    agent any

    parameters {
        string(name: 'ENTITY_ID', defaultValue: '', description: 'Enter Entity ID')
    }

    stages {
        stage('Parameter Input') {
            steps {
                script {
                    echo "Entity ID: ${params.ENTITY_ID}"
                }
            }
        }

        stage('API Call') {
            steps {
                script {
                    // Only encode the colon in the EntityId part of the URL
                    def encodedEntityId = "${params.ENTITY_ID}".replaceAll(':', '%3A')
                    def apiURL = "https://api.eu1.dome9.com/v2/vulnerability/scan-results?EntityType=Image&EntityId=${encodedEntityId}"

                    // Execute the curl command
                    sh "curl --request GET \
                        --url '${apiURL}' \
                        --header 'accept: application/json' \
                        --header 'authorization: Basic YjA1NGE5NWUtZDhlNy00ZmNlLWJmMDctMWFhMjI3NmI4Zjc5Omkxc2R5dHhkb2lpeW44b2hiODd1Z2tmbg=='"
                }
            }
        }
    }
}
